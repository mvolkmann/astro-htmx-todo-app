---
import ItemCount from '../../../components/ItemCount.astro';
import TodoItem from '../../../components/TodoItem.astro';
import { createTodo, getItemsLeft } from '../../../data/todos'

if (Astro.request.method !== 'POST') {
    return Astro.redirect(null, 404)
}

const formData = await Astro.request.formData()
const todo = formData.get('todo')?.toString()

if (!todo) {
    return new Response('"todo" is required', { status: 400 })
}

const newTodo = createTodo(todo)
---

<ItemCount itemCount={getItemsLeft()} />
<TodoItem todo={newTodo} />